COPY (SELECT t1.pix, 'delta-p1' AS label, round(t2.for_age-t1.for_age,3) AS delta_for_age, round(t2.for_con-t1.for_con,3) AS delta_for_con, round(t2.cmi_sm-t1.cmi_sm,3) AS delta_cmi_sm, round(t2.dd5_wt-t1.dd5_wt,3) AS delta_dd5_wt FROM (SELECT pix, year, for_age, for_con, cmi_sm, dd5_wt FROM 'df2_all_pts_v3.csv' WHERE year = 2003) t1 JOIN (SELECT pix, year, for_age, for_con, cmi_sm, dd5_wt FROM 'df2_all_pts_v3.csv' WHERE year = 2007) t2 ON t1.pix=t2.pix) TO 'df2_trends_p1_delta_v1.csv' (HEADER);